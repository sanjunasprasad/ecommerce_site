<%-include('header') -%>
<%-include('headsection') -%>

        <style>

            body {

                background-color: #f4f4f4;
                margin: 0;
                padding: 0;
            }

            .containerbox {
                max-width: 1200px;
                margin: 0 auto;
                padding: 5px;
            }

            h1 {
                text-align: center;
                margin-bottom: 30px;
            }

            .product-card {
                border: 1px solid #ccc;
                background-color: #fff;
                margin: 10px;
                padding: 10px;
                /* Adjusted padding */
                text-align: center;
                width: 30%;
                /* Adjusted width for smaller cards */
                display: inline-block;
                vertical-align: top;
            }

            .product-card img {
                max-width: 100%;
                height: auto;
            }

            .product-title {
                font-weight: bold;
                margin-top: 10px;
            }

            .product-description {
                margin-top: 10px;
            }

            .product-price {
                font-size: 18px;
                margin-top: 10px;
            }

            .pagination {
                text-align: center;
                margin-top: 20px;
            }

            .pagination a {
                text-decoration: none;
                padding: 5px 10px;
                border: 1px solid #ccc;
                margin: 5px;
            }

            .sorting {
                text-align: center;
                margin-bottom: 20px;
            }

            .sorting select {
                padding: 5px;
            }

            .rounded-button {
                background-color: black;
                color: white;
                border: none;
                border-radius: 20px;
                /* Adjust the radius for desired roundness */
                padding: 10px 20px;
                /* Adjust padding as needed */
                cursor: pointer;
            }

            .custom {
                width: 42px;
                height: 38px;
            }
        </style>


        <!-- Start All Title Box -->
        <div class="all-title-box">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <h2>SHOP</h2>
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">Home</a></li>
                            <li class="breadcrumb-item active">SHOP</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- End All Title Box -->

        <!-- product details starts -->
        <div class="cart-box-main">
            <div class="containerbox">
                <div class="containerbox">
                    <div class="row">
                        <!-- Multiple filter
                    <div class="col-md-4 text-center">
                        <div class="filter-icon">Filter <i class="fas fa-filter"></i> </div>
                    </div> -->




                        <!-- Sorting Dropdown -->
                        <div class="col-md-4">
                            <div class="sorting">
                                <label for="sort">Sort by:</label>
                                <select name="sortby" id="sortOptions" onchange="sortProducts()">
                                    <option value="relevant" selected="selected">Relevance</option>
                                    <option value="desc">Price: High to Low</option>
                                    <option value="asc">Price: Low to High</option>
                                </select>

                            </div>
                        </div>

                        <!-- Search Form -->
                        <div class="col-lg-4 col-md-6 col-sm-12">
                            <form action="/shop" method="get">
                                <div class="input-group">
                                    <div class="form-outline">
                                        <input type="search" class="form-control" name="search" id="q" placeholder="Search in..." required />
                                        <label class="form-label" for="form1"></label>
                                    </div>
                                    <button type="button" class="btn custom btn-dark">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                    </div>
                </div>

                <!-- Product Cards -->
               
                    <% productData.forEach(async(product) => { %>
                        <div class="product-card" id="productList">
                          <a href="/prodetail?id=<%= product._id %>">
                            <div class="image-container">
                              <img src="<%= product.imageUrl[0].url %>" alt="">
                             
                            </div>
                          </a>
                          <h3 class="ec-pro-title">
                            <a href="/prodetail?id=<%= product._id %>"><%= product.name %></a>
                          </h3>
                          <div class="product-price">â‚¹<%= product.price %></div>
                          <div class="product-description"><%= product.description %></div>
                          <div class="icon-container">
                            <!-- <li class="side-menu"><a href="#"><i class="fa fa-shopping-bag"></i></a></li> -->
                            <!-- <li class="wishlist"><a href="#"><i class="fa fa-heart"></i></a></li> -->
                          </div>
                        </div>
                      <% }); %>
                      
                    




                       

            </div>
        </div>
        <!-- product details ends -->
        <%-include('footer') -%>


            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"
                integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw=="
                crossorigin="anonymous" referrerpolicy="no-referrer"></script>
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.all.min.js"></script>
            <!-- Include jQuery library -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

            <!-- Include jQuery Validation plugin -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>




            <!-- Main Js -->
            <script src="/js/vendor/index.js"></script>
            <script src="/js/main.js"></script>
            <script src="/js/users.js"></script>
            <script src="/js/userOrder.js"></script>
            <!-- Include SweetAlert CSS -->
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.css">
            <!-- Razorpay SDK -->
            <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

            <!-- Include SweetAlert JS -->
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.js"></script>
            <script src="https://kit.fontawesome.com/7fdb179fcf.js" crossorigin="anonymous"></script>


    <script>
        // Define the filteredData function
        const filteredData = (data) => {
    const productList = document.getElementById('productList');
    productList.innerHTML = ''; // Clear existing products

    if (data.length > 0) {
        let row = document.createElement('div');
        row.classList.add('row');
        productList.appendChild(row);

        data.forEach((product, index) => {
            if (index % 4 === 0) {
                // Start a new row after every 4 products
                row = document.createElement('div');
                row.classList.add('row');
                productList.appendChild(row);
            }

            // Create a new product card for each product
            const productCard = document.createElement('div');
            productCard.classList.add('col-lg-3', 'col-md-6', 'col-sm-6', 'col-6', 'mb-6', 'pro-gl-content');
            productCard.innerHTML = `
                <div class="ec-product-inner">
                    <!-- Include your product card HTML structure here based on product data -->
                    <!-- ... -->
                </div>
            `;

            row.appendChild(productCard);
        });
    } else {
        productList.innerHTML = `
            <div class="col-6 col-md-4 col-lg-4">
                <div class="product product-7 text-center">
                    <div class="error-content text-center">
                        <div class="container">
                            <h1 class="error-title">Error 404</h1>
                            <p>We are sorry, the page you've requested is not available.</p>
                            <a href="/home" class="btn btn-outline-primary-2 btn-minwidth-lg">
                                <span>BACK TO HOMEPAGE</span>
                                <i class="icon-long-arrow-right"></i>
                            </a>
                        </div><!-- End .container -->
                    </div><!-- End .error-content text-center -->
                </div>
            </div>
        `;
    }
};

        // Define the categoryFilter function
        const categoryFilter = async (categoryId) => {
            const response = await fetch(`/categoryFilter?categoryId=${categoryId}`, {
                headers: {
                    "Content-Type": "application/json",
                },
            });

            const data = await response.json();

            if (data.length > 0) {
                filteredData(data); // Display filtered products
            } else {
                const productList = document.getElementById('productList');
                productList.innerHTML = `
                    <div class="products mb-3" id="productList">
                        <div class="row justify-content-center">
                            <div class="col-12">
                                <div class="alert alert-info text-center">No products found for the selected category.</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        };
    </script>

    <!-- Include jQuery and other scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.all.min.js"></script>
    <!-- Add other script includes as needed -->


