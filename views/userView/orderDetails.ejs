<%- include('header') %>
<%- include('headsection') %>

<!-- Start All Title Box -->
<div class="all-title-box">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <h2>My Account</h2>
          <ul class="breadcrumb">
            <li class="breadcrumb-item"><a href="/shop">Shop</a></li>
            <li class="breadcrumb-item active">Order Details</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <!-- End All Title Box -->

  
<style>
   .product.product-list .product-list-action {
    padding: 0
    
}
.product-image {
    max-width: 100px; /* Adjust this value as per your requirements */
    height: auto; /* This ensures that the aspect ratio is maintained */
}
.widget-clean {
    
    padding-bottom: 1rem;
}

.order-one{
    font-size: 12pt;
    font-weight: 500;
    color: rgb(90, 90, 90);
}

.order-two{
    font-size: 12pt;
    font-weight: 500;
    color: #c96;
}

.product-cat a{
    font-size: 13pt;
}

.product-title{
    font-size: 20pt;
    font-weight: 400;
    margin-top: 1rem;
}


.product-info {
    display: flex;
    align-items: center;
}

.product-info p{
    font-size: 13pt;
    font-weight: 400;
}

.product-info span p{
    color: #c96;
    margin-left: 1rem;
    font-weight: 500;
}

.product.product-list .ratings-container {
     margin-bottom: 0rem;
}

.mt-1 {
    margin-top: 0rem !important;
}

.ratings-container {
    
    margin-bottom: 0rem;
    
}

.product.product-list .product-content {
    
    margin-bottom: 1.5rem;
    padding-top: 0.5rem;
}

.summary {
    padding: 2.5rem 1.2rem 3rem;
}
.product p:hover {
    cursor: pointer;
}

.fa-regular.fa-file-lines{
    color: black;
    transition: 200ms;
}
.btn-outline-dark-2:hover .fa-regular.fa-file-lines{
    color: #c96;
    transition: 200ms;
}

    .success-message {
  display: flex;
  
  justify-content: start;
  align-items: center;
}

.success-message i {
  margin-right: 5px;
  margin-top: 4px;
  font-size: 2rem; 
}
.error-title {
    font-size: 2rem;
    margin-top: 1.8rem;
    margin-left: 0.3rem;
}
.refund-message p{
    padding-left: 2.8rem;
    margin-top: -13px;
    font-size: 9pt;
}
h3 {
    font-weight: 400;
    font-size: 1.4rem;
    opacity: 0.9;
    letter-spacing: -.01em;
    margin-bottom: 1.8rem;
}
.product-desc-content h6 {
    font-size: 1.8rem;
    letter-spacing: -.01em;
}
</style>


<div class="cart-box-main">
<main class="main">
   
  
    <div class="page-content">
        <div class="container">
            <div class="row">
                <div class="col-lg-9">

                    <div class="products mb-3">
                        <% orderProductData.forEach(order => { %>
                        <div class="product product-list">

                            <div class="row">
                                <div class="col-6 col-lg-3">
                                    <figure class="product-media">
                                        <a href="product.html">
                                            <img src="<%= order.image %>" alt="Product image" class="product-image">
                                        </a>
                                    </figure><!-- End .product-media -->
                                </div><!-- End .col-sm-6 col-lg-3 -->
                                
                                <div class="col-lg-7">
                                    <div class="product-body product-action-inner pt-3">
                                        <div class="product-cat">
                                            <a href="#"><%= order.category.category %></a>
                                        </div><!-- End .product-cat -->
                                        <h3 class="product-title mb-1"><a href="product.html"><%= order.name %></a></h3><!-- End .product-title -->

                                        <div class="ratings-container mt-1">
                                            <div class="ratings">
                                                <div class="ratings-val" style="width: 20%;"></div><!-- End .ratings-val -->
                                            </div><!-- End .ratings -->
                                           
                                        </div><!-- End .rating-container -->

                                        <div class="product-content pt-1">
                                            <div class="product-info" style="margin-bottom: 5px;">
                                                <p>Price :</p> <span>
                                                   
                                                    <div class="row ml-1">
                                                       
                                                        <p class="new-price">₹ <%= order.price %></p>
                                                    </div>
                                                   
                                                    
                                                </span>

                                            </div>

                                            <div class="product-info">
                                                <p>Quantity :</p> <span>
                                                    <p> x  <%= order.quantity %> </p>
                                                </span>
                                            </div>

                                        </div>

                                    </div><!-- End .product-body -->
                                </div><!-- End .col-lg-6 -->

                            </div><!-- End .row -->

                        </div><!-- End .product -->
                        <% }) %>
                    </div>

                    <div class="row">

                        <div class="col-lg-12 product product-list pb-0">
                            <div class="product-desc-content">
                                <h6>Delivery & returns</h6>
                                <p>
                                    We hope you’ll love every purchase, but if you ever need to return an item you can do so
                                    within <strong>7 days </strong>of receipt. For further assistance, contact our customer support team.
                                    We're here to help!"</p>
                            </div>
                            <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js" 
                            integrity="sha512-CryKbMe7sjSCDPl18jtJI5DR5jtkUWxPXWaLCst6QjH8wxDexfRJic2WRmRXmstr2Y8SxDDWuBO6CQC6IE4KTA==" 
                            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
                         
                            <script>
                                function momentLoadedSuccessfully() {
                                  console.log('Moment.js loaded successfully.');
                                  // You can do additional tasks or operations here
                                }
                              </script>
                            
                            <% if (orderDetails.ExpectedDeliveryDate) { %>
                            <div id="expectedDate" class="dates pt-2">
                                <div class="row ">

                                    <div class="col-lg-10 d-flex align-items-center m-0">

                                        <h4 class="m-0">Sit back and relax. Your items will arrive by</h4>

                                        <h4 class="ml-2 mb-0" style="color: green;"><%= ExpectedDeliveryDate %></h4>


                                    </div>

                                </div>
                            </div>
                            <% } %>
                            <% if (orderDetails.deliveredDate) { %>
                                <div class="dates pt-2">
                                    <div class="row ">
                                        <div class="col-lg-3 d-flex align-items-center m-0 pr-0">
                                            <h3 class="m-0">Delivered Date :</h3>
                                            <p class="ml-2"><%= deliveryDate %></p>
                                        </div>
                                        <div class="col-lg-4 d-flex align-items-center ml-2">
                                            <h3 class="m-0">Return Valid Till :</h3>
                                            <p class="ml-2"><%= returnEndDate%></p>
                                        </div>
                                    </div>
                                </div>
                            <% } %>
                          

                            <div class="refund-return-information mb-2 pt-1">
                                <div class="row">
                                    <div class="col-lg-3 mt-2">
                                        <div class="product">
                                        
                                            <% if (orderDetails.status === "Delivered") { %>
                                            <% if (returnEndDate <= currentDate) { %>
                                            <div id="orderStatusBtn">
                                                <p style="color: #c96;" class="disabled btn-product btn-cart icon-info-circle"><span>Return Period Over</span></p>
                                            </div>
                                            <% } else { %>
                                            <div id="orderStatusBtn">
                                                <p onclick="returnOrder()" class="btn-product btn-cart icon-info-circle"><span id="updateOrder" class="btn btn-sm btn-primary " >Return Order</span></p>
                                            </div>
                                            <% } %>
                                            <% } else if (orderDetails.status === "Cancelled") { %>
                                            <div id="orderStatusBtn">
                                                <p style="color: #c96;" class="disabled btn-product btn-cart icon-info-circle"><span>Order Cancelled</span></p>
                                            </div>
                                            <% } else if (orderDetails.status === "Returned") { %>
                                            <div id="orderStatusBtn">
                                                <p style="color: #c96;" class="disabled btn-product btn-cart icon-info-circle"><span>Order Returned</span></p>
                                            </div>
                                            <% } else if (orderDetails.status === "Pending") { %>
                                            <div id="orderStatusBtn">
                                                <p onclick="cancelOrder()" class="btn btn-sm btn-primary "><span id="updateOrder" >Cancel Order</span></p>
                                            </div>
                                            <% } %>
                                            <input type="hidden" id="orderId" value="<%= orderDetails._id %>">
                                        </div>
                                    </div>

                                    <% if (orderDetails.status === "Returned") { %>
                                    <div class="col-lg-8 ml-4 mr-4">
                                        <div class="success-message">
                                            <i class="fa-solid fa-circle-check" style="color: #2fad01;"></i>
                                            <h1 class="error-title">Refund Initiated</h1>
                                        </div>
                                        <div class="refund-message">
                                            <p>wil be refelected in your wallet within <strong>7 business days</strong></p>
                                        </div>
                                    </div>
                                    <% } %>

                                    

                                    <div id="refundMessage" class="col-lg-8 ml-4 mr-4 d-none">
                                        <div class="success-message">
                                            <i class="fa-solid fa-circle-check" style="color: #2fad01;"></i>
                                            <h1 class="error-title">Refund Initiated</h1>
                                        </div>
                                        <div class="refund-message">
                                            <p>wil be refelected in your wallet within <strong>7 business days</strong></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div><!-- End .col-lg-9 -->

                <aside class="col-lg-3">
                    <div class="summary">
                        <div class="sidebar sidebar-shop ">
                            <div class="widget widget-clean">
                                <p style="font-size: 16pt; font-weight: 600; color:black;">Order Summary</p>
                            </div><!-- End .widget widget-clean -->

                            <div class="product-list-action ">
                                <table class="table table-summary">
                                    <tr>
                                        <td class="order-one">Grand Total :</td>
                                        <td class="order-two" style="text-align: end;">₹ <%= orderDetails.total %></td>
                                        <input type="hidden" id="grandTotal" value="<%= orderDetails.total %>">
                                    </tr>
                                    
                                    <tr>
                                        <td class="order-one">Payment method :</td>
                                        <td class="order-two" id="paymentMethod"><%= orderDetails.paymentMethod %></td>
                                    </tr>

                                    

                                </table>

                                <table class="table table-summary">
                                    <h6 class="mt-2" style="color: black;">Delivery Address :</h6>
                                    <div class="address-data">
                                        <tr>
                                            <td>Name: <br>Mobile: <br>Email: <br> Home: <br>City: <br>State: <br>Pincode: </td>
                                            <td><%= address.name %><br><%= address.mobile %> <br> <%= address.email %> <br><%= address.addressLine %><br><%= address.city %>
                                                <br><%= address.state %> <br><%= address.pincode %></td>
                                        </tr>
                                    </div>
                                </table>

                            </div><!-- End .product-list-action -->
                        </div><!-- End .sidebar sidebar-shop -->
                    </div>

                    <% if (orderDetails.status === "Delivered") { %>
                    <div class="download-invoice">
                        <a href="/downloadInvoice?orderId=<%= orderDetails._id %>" class="btn btn-outline-dark-2 btn-block mb-3">
                            <span class="btn btn-sm btn-primary " >DOWNLOAD INVOICE</span>
                            <i class="fa-regular fa-file-lines"></i>
                        </a>
                    </div>
                    <% } %>

                </aside><!-- End .col-lg-3 -->
            </div><!-- End .row -->
        </div><!-- End .container -->
    </div><!-- End .page-content -->
</main><!-- End .main -->
<!-- Add the moment library -->

<%- include('footer') %>




<!-- Main Js -->
<script src="/js/vendor/index.js"></script>
<script src="/js/main.js"></script>
<script src="/js/users.js"></script>
<script src="/js/userOrder.js"></script>
<!-- Include SweetAlert CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.css">
<!-- Razorpay SDK -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<!-- Include SweetAlert JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.js"></script>
<script src="https://kit.fontawesome.com/7fdb179fcf.js" crossorigin="anonymous"></script>


